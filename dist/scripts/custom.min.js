var GroundWaterWatch;!function(e){var t=function(){function e(e,t,r,o){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$logProvider=o,this.$stateProvider.state("main",{url:"/?ncd&sc&cc&S",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"GroundWaterWatch.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"GroundWaterWatch.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"GroundWaterWatch.Controllers.NavbarController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider"],e}();angular.module("GroundWaterWatch",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","angulartics","angulartics.google.analytics","toaster","ngAnimate","ngFileUpload","leaflet-directive","GroundWaterWatch.Services","GroundWaterWatch.Controllers","WiM.Services","WiM.Event","wim_angular","angularResizable","angular-multi-select"]).config(t)}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){var t=function(){function e(){}return e.FromJson=function(t){if(!t)return null;var r=t.hasOwnProperty("properties")?t.properties:null,o=new e;return o.siteNO=r.hasOwnProperty("SITE_NO")?r.SITE_NO:"---",o.siteName=r.hasOwnProperty("SITE_NAME")?r.SITE_NAME:"---",o.measurement=r.hasOwnProperty("LATEST_VALUE")?r.LATEST_VALUE:Number.NaN,o.measurementDate=r.hasOwnProperty("LATEST_DATE")?r.LATEST_DATE:null,o.wellDepth=r.hasOwnProperty("WELL_DEPTH")?r.WELL_DEPTH:Number.NaN,o.localAquiferName=r.hasOwnProperty("LOCAL_AQUIFER_NAME")?r.LOCAL_AQUIFER_NAME:"---",o.stateName=r.hasOwnProperty("STATE_NM")?r.STATE_NM:"---",o.countyName=r.hasOwnProperty("COUNTY_NM")?r.COUNTY_NM:"---",o.geometry=t.hasOwnProperty("geometry")?r.geometry:null,o},e}();e.GroundWaterSite=t}(t=e.Models||(e.Models={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){var t=function(){function e(e,t){this.item=e,this.Type=t}return e}();e.GroundWaterFilterSite=t,function(e){e[e.STATE=1]="STATE",e[e.COUNTY=2]="COUNTY",e[e.NETWORK=3]="NETWORK",e[e.AQUIFER=4]="AQUIFER",e[e.SITE=5]="SITE"}(e.FilterType||(e.FilterType={}));e.FilterType}(t=e.Models||(e.Models={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){var t=function(){function e(e,t,o,n,i,a){void 0===t&&(t=r.e_info),void 0===o&&(o=""),void 0===n&&(n=!1),void 0===i&&(i=5e3),void 0===a&&(a=null),this.type=this.getType(t),this.title=o,this.timeout=i,this.toastId=a,this.showCloseButton=n,this.body=e}return e.prototype.getType=function(e){switch(e){case r.e_error:return"error";case r.e_info:return"info";case r.e_success:return"success";case r.e_wait:return"wait";case r.e_warning:return"warning"}},e}();e.Notification=t,function(e){e[e.e_error=-1]="e_error",e[e.e_info=0]="e_info",e[e.e_wait=1]="e_wait",e[e.e_success=2]="e_success",e[e.e_warning=3]="e_warning"}(e.NotificationType||(e.NotificationType={}));var r=e.NotificationType}(t=e.Models||(e.Models={}))}(GroundWaterWatch||(GroundWaterWatch={})),function(){"use strict";angular.module("GroundWaterWatch.Services",[])}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(e){"use strict";function t(e,t,o){return new r(e,t,o)}var r=function(e){function t(t,r,o){e.call(this,t,configuration.baseurls.GroundWaterWatch),this.$q=r,this.toaster=o,this.drawElevationProfile=!1,this.drawMeasurement=!1,this.showElevationChart=!1,this.allowStreamgageQuery=!1,this.measurementData=""}return __extends(t,e),t.prototype.elevationProfile=function(e){var t=this,r="http://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",o=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:e,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(o).then(function(e){var r=e.data.results[0].value.features[0].geometry.paths[0];r.length>0&&(t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:r},properties:""}]})},function(e){})["finally"](function(){})},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("GroundWaterWatch.Services").factory("GroundWaterWatch.Services.ExplorationService",t)}(t=e.Services||(e.Services={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){"use strict";function t(e){return new r(e)}var r=function(){function e(e){this.modal=e,this.modalOptions={tabName:"about"}}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),t&&(this.modalOptions=t),this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case o.e_filter:return{templateUrl:"Views/filtermodal.html",controller:"GroundWaterWatch.Controllers.FilterModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case o.e_about:return{templateUrl:"Views/aboutmodal.html",controller:"GroundWaterWatch.Controllers.AboutModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case o.e_siteinfo:return{templateUrl:"Views/siteinfomodal.html",controller:"GroundWaterWatch.Controllers.SiteInfoModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};default:return{templateUrl:"Views/aboutmodal.html",controller:"GroundWaterWatch.Controllers.AboutModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"}}}catch(t){return!1}},e}();!function(e){e[e.e_filter=1]="e_filter",e[e.e_about=2]="e_about",e[e.e_siteinfo=3]="e_siteinfo"}(e.ModalType||(e.ModalType={}));var o=e.ModalType;t.$inject=["$modal"],angular.module("GroundWaterWatch.Services").factory("GroundWaterWatch.Services.ModalService",t)}(t=e.Services||(e.Services={}))}(GroundWaterWatch||(GroundWaterWatch={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(t){"use strict";function r(e,t,r,o){return new i(e,t,r,o)}t.onSelectedGWSiteChanged="onSelectedGWSiteChanged",t.onGWSiteSelectionChanged="onGWSiteSelectionChanged";var o=function(e){function t(t,r){void 0===t&&(t=[]),void 0===r&&(r=null),e.call(this),this.featurelist=t,this.bbox=r}return __extends(t,e),t}(WiM.Event.EventArgs);t.GWSiteSelectionEventArgs=o;var n=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),i=function(r){function i(e,t,o,n){r.call(this,e,configuration.baseurls.GroundWaterWatch),this.toaster=n,this.SelectedGWFilters=[],this.mapCenter=null,this._eventManager=t,this.queriedGWsite=!1,this.init(),o.ncd||o.sc||o.cc||o.S||this.loadLookups()}return __extends(i,r),Object.defineProperty(i.prototype,"GWSiteList",{get:function(){return this._GWSiteList},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"SelectedGWSite",{get:function(){return this._selectedGWSite},set:function(e){e!=this._selectedGWSite&&(this._selectedGWSite=e,this._eventManager.RaiseEvent(t.onSelectedGWSiteChanged,this,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"StateList",{get:function(){return this._states},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"AquiferList",{get:function(){return this._aquifers},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"NetworkList",{get:function(){return this._networks},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"SelectedPrimaryNetwork",{get:function(){return this._selectedPrimaryNetwork},set:function(t){this._selectedPrimaryNetwork!==t&&(this._selectedPrimaryNetwork=t,this.SelectedGWFilters.length=0,this.SelectedGWFilters.push(new e.Models.GroundWaterFilterSite(t,e.Models.FilterType.NETWORK)),this.sm("Primary network changed to "+t.name,e.Models.NotificationType.e_success,"Groundwater watch"))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"PrimaryNetworkList",{get:function(){return this._primaryNetworks},enumerable:!0,configurable:!0}),i.prototype.AddFilterTypes=function(e){var t=this;e.forEach(function(e){return t.SelectedGWFilters.push(e)})},i.prototype.getFilterRequest=function(){if(this.SelectedGWFilters.length<1)return"";var t=[],r=this.SelectedGWFilters.group("Type"),o=r.hasOwnProperty(e.Models.FilterType.COUNTY.toString())?r[e.Models.FilterType.COUNTY.toString()].map(function(e){return"STATE_CD='{0}' ;COUNTY_CD='{1}'".format(e.item.statecode,e.item.code)}):null;null!==o&&t.push(o.join(";"));var n=r.hasOwnProperty(e.Models.FilterType.STATE.toString())?r[e.Models.FilterType.STATE.toString()].map(function(e){return e.item.code}):null;null!==n&&t.push("STATE_CD in ('"+n.join("','")+"')");var i=r.hasOwnProperty(e.Models.FilterType.NETWORK.toString())?r[e.Models.FilterType.NETWORK.toString()].map(function(e){return e.item.code}):null;null!==i&&t.push("NETWORK_CD in ('"+i.join("','")+"')");var a=r.hasOwnProperty(e.Models.FilterType.SITE.toString())?r[e.Models.FilterType.SITE.toString()].map(function(e){return e.item.code}):null;return null!==a&&t.push("SITE_NO in ('"+a.join("','")+"')"),t.join(";")},i.prototype.queryGWsite=function(r,n){var i=this;this.sm("Selecting site, please wait....",e.Models.NotificationType.e_wait,"Groundwater watch"),this.queriedGWsite=!1;var a=5e-4;3>=n&&(a=.5),n>3&&6>=n&&(a=.1),n>6&&10>=n&&(a=.01),n>10&&12>=n&&(a=.005),console.log("click buffer: ",a);var s=r.lat+a+","+(r.lng-a)+","+(r.lat-a)+","+(r.lng+a);console.log("buffered bbox: ",s);var l=configuration.baseurls.GroundWaterWatch+configuration.queryparams.WFSquery;l+="&CQL_FILTER=BBOX(GEOM,{0})".format(s),null!=this.SelectedPrimaryNetwork&&(l+="AND NETWORK_CD in ('"+this.SelectedPrimaryNetwork.code+"')");var c=this.SelectedGWFilters.group("Type"),u=c.hasOwnProperty(e.Models.FilterType.NETWORK.toString())?c[e.Models.FilterType.NETWORK.toString()].map(function(e){return e.item.code}):null;null!==u&&(l+="AND NETWORK_CD in ('"+u.join("','")+"')");var d=new WiM.Services.Helpers.RequestInfo(l,!0,WiM.Services.Helpers.methodType.GET,"",null,{"Accept-Encoding":"gzip"});this.Execute(d).then(function(r){i.queriedGWsite=!0,r.data.features&&r.data.features.length>0?(console.log(r.data.features.length," gww sites found"),i.sm("Found site",e.Models.NotificationType.e_success,"Groundwater watch"),i._eventManager.RaiseEvent(t.onGWSiteSelectionChanged,i,new o(r.data.features,r.data.bbox))):(i.sm("Site not found, please try again",e.Models.NotificationType.e_warning,"Groundwater watch"),i.SelectedGWSite=null)},function(t){i.sm("Error finding site, please try again",e.Models.NotificationType.e_error,"Groundwater watch")})["finally"](function(){})},i.prototype.queryGWsiteByNOs=function(r){var n=this;this.queriedGWsite=!1,this.sm("Finding Site by Site number.",e.Models.NotificationType.e_info,"Groundwater watch.");var i=configuration.baseurls.GroundWaterWatch+configuration.queryparams.WFSquery;i+="&CQL_FILTER=SITE_NO in ({0})".format(r);var a=this.SelectedGWFilters.group("Type"),s=a.hasOwnProperty(e.Models.FilterType.NETWORK.toString())?a[e.Models.FilterType.NETWORK.toString()].map(function(e){return e.item.code}):null;null!==s&&(i+="AND NETWORK_CD in ('"+s.join("','")+"')");var l=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.GET,"",null,{"Accept-Encoding":"gzip"});this.Execute(l).then(function(r){n.queriedGWsite=!0,r.data.features&&r.data.features.length>0?(console.log(r.data.features.length," gww sites found"),n.sm("Found site",e.Models.NotificationType.e_success,"Groundwater watch"),n._eventManager.RaiseEvent(t.onGWSiteSelectionChanged,n,new o(r.data.features,r.data.bbox))):(n.sm("Site not found, please try againg",e.Models.NotificationType.e_warning,"Groundwater watch"),n.SelectedGWSite=null)},function(t){n.sm("Error finding site, please try again",e.Models.NotificationType.e_error,"Groundwater watch")})["finally"](function(){})},i.prototype.loadCounties=function(e){var t=this,r=configuration.overlayedLayers.counties.url+"/15/query?returnGeometry=false&where=STATE='{0}'&outSr=4326&outFields=COUNTY,STATE,ABBREV,NAME&f=json".format(e.code),o=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(o).then(function(r){t.queriedGWsite=!0,r.data.features.length>0?e.Counties=r.data.features.map(function(e){return{name:e.attributes.NAME+", "+e.attributes.ABBREV,code:e.attributes.COUNTY,statecode:e.attributes.STATE}}):(console.log("No gww sites found"),t.SelectedGWSite=null)},function(e){console.log("No gww sites found")})["finally"](function(){})},i.prototype.init=function(){this._GWSiteList=[],this._eventManager.AddEvent(t.onSelectedGWSiteChanged),this._eventManager.AddEvent(t.onSelectedGWSiteChanged),this.mapCenter=new n(39,-100,3)},i.prototype.loadLookups=function(){this.loadStates(),this.loadAquifers(),this.loadLocalNetworks(),this.loadPrimaryNetworks()},i.prototype.updateGWWSiteList=function(){var t=this;this.sm("Updating site list.",e.Models.NotificationType.e_info,"Services");var r=configuration.baseurls.GroundWaterWatch+configuration.queryparams.WFSquery;null!=this.SelectedPrimaryNetwork&&(r+="&CQL_FILTER=NETWORK_CD in ('"+this.SelectedPrimaryNetwork.code+"')");var o=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(o).then(function(r){t.queriedGWsite=!0,r.data.features&&r.data.features.length>0?(t.sm("Found "+r.data.features.length+" sites",e.Models.NotificationType.e_success,"Services"),r.data.features.forEach(function(e){})):(t.sm("No sites found.",e.Models.NotificationType.e_info,"Groundwater watch"),t.SelectedGWSite=null)},function(r){t.sm("Error finding sites.",e.Models.NotificationType.e_error,"Services")})["finally"](function(){})},i.prototype.loadStates=function(){var e=this,t=new WiM.Services.Helpers.RequestInfo("sc.js",!0);this.Execute(t).then(function(t){e._states=t.data},function(e){console.log("No gww sites found")})["finally"](function(){})},i.prototype.loadAquifers=function(){var e=this;console.log("Loading Aquifers");var t=new WiM.Services.Helpers.RequestInfo("acd.js",!0);this.Execute(t).then(function(t){e._aquifers=t.data},function(e){console.log("No gww sites found")})["finally"](function(){})},i.prototype.loadLocalNetworks=function(){var e=this;console.log("Loading networks");var t=new WiM.Services.Helpers.RequestInfo("lcd.js",!0);this.Execute(t).then(function(t){e._networks=t.data},function(e){console.log("No gww sites found")})["finally"](function(){})},i.prototype.loadPrimaryNetworks=function(){var e=this;console.log("Loading networks");var t=new WiM.Services.Helpers.RequestInfo("ncd.js",!0);this.Execute(t).then(function(t){e._primaryNetworks=t.data,e.primaryNetworkInfos=e._primaryNetworks,e.SelectedPrimaryNetwork=e._primaryNetworks[0]},function(e){console.log("No gww sites found")})["finally"](function(){})},i.prototype.sm=function(t,r,o,n,i,a){void 0===o&&(o=""),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===a&&(a=5e3),this.toaster.pop(new e.Models.Notification(t,r,o,n,a,i))},i}(WiM.Services.HTTPServiceBase);r.$inject=["$http","WiM.Event.EventManager","$stateParams","toaster"],angular.module("GroundWaterWatch.Services").factory("GroundWaterWatch.Services.GroundWaterWatchService",r)}(t=e.Services||(e.Services={}))}(GroundWaterWatch||(GroundWaterWatch={})),function(){"use strict";angular.module("GroundWaterWatch.Controllers",[])}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.lat=e,this.lng=t}return e}(),o=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),n=(function(){function e(e,t,r,o,n){void 0===n&&(n=void 0),this.name=e,this.url=t,this.type=r,this.visible=o,this.layerOptions=n}return e}(),function(){function e(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}return e}());t.onBoundingBoxChanged="onBoundingBoxChanged";var i=function(e){function t(t,r){e.call(this),this.zoomlevel=r,this.northern=t.northEast.lng,this.southern=t.southWest.lng,this.eastern=t.northEast.lat,this.western=t.southWest.lat}return __extends(t,e),t}(WiM.Event.EventArgs);t.BoundingBoxChangedEventArgs=i;var a=function(){function a(r,o,n,i,a,s,l,c,u,d,h,p,f,v){var g=this;if(this.$scope=r,this.initialized=!1,this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,r.vm=this,o.isShown=!0,this.toaster=n,this.angulartics=i,this.searchService=u,this.$locationService=a,this.leafletBoundsHelperService=l,this.leafletData=c,this.explorationService=d,this.eventManager=h,this.gwwServices=p,this.SiteList=p.GWSiteList,this.modalService=f,this.SiteListEnabled=!1,this.init(),this.eventManager.AddEvent(t.onBoundingBoxChanged),this.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){g.onLayerChanged(t)})),this.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){g.onSelectedAreaOfInterestChanged(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onGWSiteSelectionChanged,new WiM.Event.EventHandler(function(e,t){g.onGWSiteSelectionChanged(e,t)})),r.$on("leafletDirectiveMap.mainMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;g.mapPoint.lat=r.lat,g.mapPoint.lng=r.lng}),r.$on("leafletDirectiveMap.mainMap.drag",function(e,t){g.cursorStyle="grabbing"}),r.$on("leafletDirectiveMap.mainMap.dragend",function(e,t){g.cursorStyle="pointer"}),r.$watch(function(){return g.bounds},function(e,t){return g.mapBoundsChange(t,e)}),r.$on("leafletDirectiveMap.mainMap.click",function(e,t){g.leafletData.getMap("mainMap").then(function(e){g.explorationService.drawMeasurement||g.explorationService.drawElevationProfile||g.gwwServices.queryGWsite(t.leafletEvent.latlng,e.getZoom())})}),r.$watch(function(){return g.bounds},function(e,t){return g.mapBoundsChange(t,e)}),r.$watch(function(){return g.explorationService.elevationProfileGeoJSON},function(e,t){e&&g.displayElevationProfile()}),r.$watch(function(){return g.explorationService.drawElevationProfile},function(e,t){e&&g.elevationProfile()}),r.$watch(function(){return g.explorationService.drawMeasurement},function(e,t){e&&g.measurement()}),r.$watch(function(){return g.SiteList},function(e,t){e.length>0?g.SiteListEnabled=!0:g.SiteListEnabled=!1}),r.$watchCollection(function(){return g.gwwServices.SelectedGWFilters},function(e,t){e&&g.updateMapFilters()}),v(function(){g.leafletData.getMap("mainMap").then(function(e){e.invalidateSize()})}),s.ncd||s.sc||s.cc||s.S){var y=[];s.ncd&&s.ncd.split(",").forEach(function(t){y.push(new e.Models.GroundWaterFilterSite({code:t},e.Models.FilterType.NETWORK))}),s.sc&&!s.cc?s.sc.split(",").forEach(function(t){y.push(new e.Models.GroundWaterFilterSite({code:t},e.Models.FilterType.STATE))}):s.sc&&s.cc&&s.sc.split(",").forEach(function(t){s.cc.split(",").forEach(function(r){y.push(new e.Models.GroundWaterFilterSite({code:r,statecode:t},e.Models.FilterType.COUNTY))})}),s.S&&s.S.split(",").forEach(function(t){y.push(new e.Models.GroundWaterFilterSite({code:t},e.Models.FilterType.SITE))}),this.gwwServices.AddFilterTypes(y),o.isShown=!1}this.initialized=!0}return a.prototype.init=function(){this.cursorStyle="pointer",this.center=this.gwwServices.mapCenter,this.nominalZoomLevel=this.scaleLookup(this.center.zoom),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new n(null,3,!0),this.markers={},this.geojson={},this.regionLayer={},this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0}))},this.events={map:{enable:["mousemove","click"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images"},a.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},a.prototype.elevationProfile=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0;var t;this.controls.custom.forEach(function(e){e._container.className.indexOf("elevation")>-1&&(t=e)}),this.angulartics.eventTrack("explorationTools",{category:"Map",label:"elevationProfile"}),this.leafletData.getMap("mainMap").then(function(r){e.leafletData.getLayers("mainMap").then(function(o){var n=o.overlays.draw;n.clearLayers(),e.drawController({metric:!1},!0),delete e.geojson.elevationProfileLine3D,r.on("draw:drawstart",function(e){t.clear()}),r.on("draw:created",function(t){r.removeEventListener("draw:created");var o=t.layer.toGeoJSON(),n='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(o.geometry.coordinates)+"]}}]}";e.cursorStyle="wait",e.toaster.pop("info","Information","Querying the elevation service...",0),e.explorationService.elevationProfile(n),e.explorationService.drawElevationProfile=!1,r.panBy([0,1])})})})},a.prototype.drawController=function(e,t){var r=this;return t?void this.leafletData.getMap("mainMap").then(function(t){r.drawControl=new L.Draw.Polyline(t,e),r.drawControl.enable()}):(this.drawControl.disable(),void(this.drawControl=void 0))},a.prototype.displayElevationProfile=function(){var e;this.controls.custom.forEach(function(t){t._container&&t._container.className.indexOf("elevation")>-1&&(e=t)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:e.addData.bind(e)},this.leafletData.getMap("mainMap").then(function(t){var r=e.onAdd(t);document.getElementById("elevation-div").innerHTML="",document.getElementById("elevation-div").appendChild(r)}),this.toaster.clear(),this.cursorStyle="pointer"},a.prototype.showLocation=function(){var e;this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start()},a.prototype.resetMap=function(){this.removeOverlayLayers("_region",!0),this.center=new o(39,-100,3)},a.prototype.resetExplorationTools=function(){var e=this;document.getElementById("elevation-div").innerHTML="",document.getElementById("measurement-div").innerHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.allowStreamgageQuery=!1,this.explorationService.drawMeasurement=!1,this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.showElevationChart=!1,this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(e){var t=e.overlays.draw;t.clearLayers()})})},a.prototype.measurement=function(){var e=this;document.getElementById("elevation-div").innerHTML="",this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"measurement"}),this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){var o=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var n=r.overlays.draw;n.clearLayers();var i=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},a=function(){0==o&&(o=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",i))},s=function(r){var o=r.layer;n.addLayer(o),n.addTo(t),e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString(),t.off("click",a),t.off("mousemove",i),t.off("draw:created",s),e.drawControl.disable(),e.explorationService.drawMeasurement=!1};t.on("click",a),t.on("draw:created",s)})})},a.prototype.onSelectedGWSiteChanged=function(){this.modalService.openModal(e.Services.ModalType.e_siteinfo)},a.prototype.onSelectedAreaOfInterestChanged=function(e,t){this.angulartics.eventTrack("Search",{category:"Sidebar"}),this.markers={};var r=t.selectedAreaOfInterest;if("U.S. State or Territory"==r.Category)var o=9;else var o=14;this.markers.AOI={lat:r.Latitude,lng:r.Longitude,message:r.Name,focus:!0,draggable:!1},this.leafletData.getMap("mainMap").then(function(e){e.setView([r.Latitude,r.Longitude],o)})},a.prototype.onGWSiteSelectionChanged=function(e,t){this.removeGeoJson("gwwsite",!0),this.addGeoJSON("gwwsite",t.featurelist[0]),null!=t.bbox&&(this.center.lat=(t.bbox[0]+t.bbox[2])/2,this.center.lng=(t.bbox[1]+t.bbox[3])/2,this.center.zoom=12)},a.prototype.removeGeoJson=function(e,t){var r=this;void 0===e&&(e=""),void 0===t&&(t=!1);var o;o=this.getLayerIdsByID(e,this.geojson,t),o.forEach(function(e){delete r.geojson[e],r.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,r,new WiM.Directives.LegendLayerRemovedEventArgs(e,"geojson"))})},a.prototype.addGeoJSON=function(e,t){var r=this;if(e.indexOf("gwwsite")>-1){var o={radius:8,color:"#FFFA20",weight:3,opacity:1,fillOpacity:0,visible:!0};this.geojson[e]={data:t,pointToLayer:function(e,t){return L.circleMarker(t,o)},onEachFeature:function(e,t){var o="     <div>";o+="          <h3>USGS Well Information </h3>",o+="          <strong>Station: </strong><a href='http://groundwaterwatch.usgs.gov/AWLSites.asp?mt=g&S={0}&ncd={1}' target='_blank' >".format(e.properties.SITE_NO,"AWL")+e.properties.SITE_NO+"</a>",o+="          <br />",o+="          <strong>Name: </strong>"+e.properties.SITE_NAME,o+="          <br />",o+="          <strong>Most Recent Measurement: </strong>"+e.properties.LATEST_VALUE,o+="          <br />",o+="          <strong>Measurement Date: </strong>"+e.properties.LATEST_DATE,o+="        </div>",t.bindPopup(o),r.leafletData.getMap("mainMap").then(function(e){t.openPopup()})}}}else this.geojson[e]={data:t,style:{fillOpacity:0}}},a.prototype.onLayerChanged=function(e){if("visible"===e.PropertyName)if(e.Value);else delete this.geojson[e.LayerName]},a.prototype.mapBoundsChange=function(e,r){e!==r&&(this.nominalZoomLevel=this.scaleLookup(this.center.zoom),this.eventManager.RaiseEvent(t.onBoundingBoxChanged,this,new i(this.bounds,this.center.zoom)))},a.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var o;o=this.getLayerIdsByID(e,this.layers.overlays,t),o.forEach(function(e){delete r.layers.overlays[e]})},a.prototype.getLayerIdsByName=function(e,t,r){var o=[];for(var n in t)t[n].hasOwnProperty("name")&&(r?t[n].name.indexOf(e)>-1:t[n].name===e)&&o.push(n);return o},a.prototype.getLayerIdsByID=function(e,t,r){var o=[];for(var n in t)(r?n.indexOf(e)>-1:n===e)&&o.push(n);return o},a.prototype.updateMapFilters=function(){var t=this;this.initialized&&this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(o){var n=t.gwwServices.getFilterRequest();""!=n?o.overlays.gww.wmsParams.CQL_FILTER=n:delete o.overlays.gww.wmsParams.CQL_FILTER,o.overlays.gww.redraw();var i=t.gwwServices.SelectedGWFilters.group("Type");if(i.hasOwnProperty(e.Models.FilterType.STATE.toString())&&o.overlays.states.query().layer(7).where(i[e.Models.FilterType.STATE.toString()].map(function(e){return"STATE = '"+e.item.code+"'"}).join(" OR ")).returnGeometry(!0).fields("STATE,ABBREV,NAME").run(function(n,a){a.features&&0!=a.features.length&&(a.features.forEach(function(e){("Polygon"===e.geometry.type||"MultiPolygon"==e.geometry.type)&&(t.removeGeoJson("STATE"+e.properties.STATE),t.addGeoJSON("STATE"+e.properties.STATE,e.geometry))}),o.overlays.states.query().layer(7).where(i[e.Models.FilterType.STATE.toString()].map(function(e){return"STATE = '"+e.item.code+"'"}).join(" OR ")).bounds(function(e,t){r.fitBounds(t)}))}),i.hasOwnProperty(e.Models.FilterType.COUNTY.toString())&&(o.overlays.counties.query().layer(15).where(i[e.Models.FilterType.COUNTY.toString()].map(function(e){return"COUNTY = '"+e.item.code+"' AND STATE ='"+e.item.statecode+"'"}).join(" OR ")).returnGeometry(!0).fields("COUNTY,STATE,NAME").run(function(e,r){r.features&&0!=r.features.length&&r.features.forEach(function(e){"Polygon"===e.geometry.type&&(t.removeGeoJson("COUNTY"+e.properties.COUNTY),t.addGeoJSON("COUNTY"+e.properties.COUNTY,e.geometry))})}),o.overlays.counties.query().layer(15).where(i[e.Models.FilterType.COUNTY.toString()].map(function(e){return"COUNTY = '"+e.item.code+"' AND STATE ='"+e.item.statecode+"'"}).join(" OR ")).bounds(function(e,t){r.fitBounds(t)})),i.hasOwnProperty(e.Models.FilterType.SITE.toString())){var a=i[e.Models.FilterType.SITE.toString()].map(function(e){return e.item.code});t.gwwServices.queryGWsiteByNOs(a.join("','"))}})})},a.prototype.sm=function(t,r,o,n,i,a){void 0===o&&(o=""),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===a&&(a=5e3),this.toaster.pop(new e.Models.Notification(t,r,o,n,a,i))},a.$inject=["$scope","$rootScope","toaster","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","GroundWaterWatch.Services.ExplorationService","WiM.Event.EventManager","GroundWaterWatch.Services.GroundWaterWatchService","GroundWaterWatch.Services.ModalService","$timeout"],a}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.MapController",a)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(t){"use strict";var r=function(){function t(e,t,r,o,n,i,a,s,l,c,u,d){this.$scope=e,e.vm=this,t.isShown=!0,this.modalService=u,this.leafletData=s,this.gwwService=c,this.selectedNetwork=null,this.init()}return Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.selectedNetwork.code===this.gwwService.SelectedPrimaryNetwork.code?!0:!1},enumerable:!0,configurable:!0}),t.prototype.initialize=function(e){this.selectedNetwork=e,this.loadGWWMapLayer()},t.prototype.openAboutModal=function(t){this.modalService.openModal(e.Services.ModalType.e_about,{tabName:t})},t.prototype.init=function(){this.center=this.gwwService.mapCenter,this.defaults={scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1,zoomControl:!1,attributionControl:!1},this.layers={baselayers:configuration.basemaps,overlays:{gww:configuration.overlayedLayers.gww}},this.loadGWWMapLayer()},t.prototype.setMainNetwork=function(){this.selectedNetwork&&(this.gwwService.SelectedPrimaryNetwork=this.selectedNetwork)},t.prototype.loadGWWMapLayer=function(){var e=this;this.selectedNetwork&&this.leafletData.getLayers(this.selectedNetwork.code).then(function(t){t.overlays.gww.wmsParams.CQL_FILTER="NETWORK_CD='"+e.selectedNetwork.code+"'",t.overlays.gww.redraw()})},t.$inject=["$scope","$rootScope","toaster","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Event.EventManager","GroundWaterWatch.Services.GroundWaterWatchService","GroundWaterWatch.Services.ModalService","$timeout"],
t}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.MiniMapController",r)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(t){"use strinct";var r,o=function(){function t(e,t,r,o,n,i,a,s,l){this.$window=l,e.vm=this,this.toaster=t,this.angulartics=r,this.searchService=n,this.groundwaterwatchService=a,this.modalService=i,this.eventManager=s,this.init()}return Object.defineProperty(t.prototype,"States",{get:function(){return this.groundwaterwatchService.StateList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Aquifers",{get:function(){return this.groundwaterwatchService.AquiferList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LocalNetworks",{get:function(){return this.groundwaterwatchService.NetworkList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PrimaryNetworks",{get:function(){return this.groundwaterwatchService.PrimaryNetworkList},enumerable:!0,configurable:!0}),t.prototype.getLocations=function(e){return this.searchService.getLocations(e)},t.prototype.setProcedureType=function(e){return this.selectedProcedure==e?void(this.selectedProcedure=0):void(this.canUpdateProcedure(e)&&(this.selectedProcedure=e))},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.zoomRegion=function(e){angular.fromJson(e)},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#sapi-searchTextBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.removeFilter=function(t,r){if(this.SelectedFilters.splice(t,1),r.Type==e.Models.FilterType.COUNTY||r.Type==e.Models.FilterType.STATE){var o=r.Type==e.Models.FilterType.COUNTY?"COUNTY":"STATE";this.eventManager.RaiseEvent(WiM.Directives.onLayerChanged,this,new WiM.Directives.LegendLayerChangedEventArgs(o+r.item.code,"visible",!1))}},t.prototype.ClearFilters=function(){var t=this;this.SelectedFilters.forEach(function(r){var o=r.Type==e.Models.FilterType.COUNTY?"COUNTY":"STATE";t.eventManager.RaiseEvent(WiM.Directives.onLayerChanged,t,new WiM.Directives.LegendLayerChangedEventArgs(o+r.item.code,"visible",!1))}),this.SelectedFilters.splice(0,this.SelectedFilters.length)},t.prototype.AddFilter=function(){this.modalService.openModal(e.Services.ModalType.e_filter)},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.OpenNetworkPage=function(t,r){this.OpenedNetwork=-1;var o="http://groundwaterwatch.usgs.gov";switch(t){case n.STATE:o+="/netmapT1L2.asp?ncd={0}&sc={1}".format(this.groundwaterwatchService.SelectedPrimaryNetwork.code,r.code);break;case n.AQUIFER:case n.LOCAL:o+="/netmapT4L1.asp?ncd="+r.code}this.sm("Opening "+r.name+" page. Please wait.",e.Models.NotificationType.e_wait,"Page Notification"),this.$window.open(o,"_self")},t.prototype.init=function(){this.SelectedFilters=this.groundwaterwatchService.SelectedGWFilters,this.sideBarCollapsed=!1,this.selectedProcedure=r.NetworkType},t.prototype.canUpdateProcedure=function(t){try{switch(t){case r.Search:return!0;case r.NetworkType:return!0;case r.Filter:return!0;default:return!1}}catch(o){return this.sm(o.message,e.Models.NotificationType.e_error,"Proceedure"),!1}},t.prototype.sm=function(t,r,o,n,i,a){void 0===o&&(o=""),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===a&&(a=5e3),this.toaster.pop(new e.Models.Notification(t,r,o,n,a,i))},t.$inject=["$scope","toaster","$stateParams","$analytics","WiM.Services.SearchAPIService","GroundWaterWatch.Services.ModalService","GroundWaterWatch.Services.GroundWaterWatchService","WiM.Event.EventManager","$window"],t}();!function(e){e[e.Search=1]="Search",e[e.NetworkType=2]="NetworkType",e[e.Filter=3]="Filter"}(r||(r={}));var n;!function(e){e[e.STATE=1]="STATE",e[e.AQUIFER=2]="AQUIFER",e[e.LOCAL=3]="LOCAL"}(n||(n={})),angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.SidebarController",o)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(t){"use strict";var r=function(){function t(e,t,r,o){e.vm=this,this.modalService=r,this.gwwService=o,this.checkAboutModal()}return Object.defineProperty(t.prototype,"ProjectName",{get:function(){return this.gwwService.SelectedPrimaryNetwork?configuration.projectName+" - "+this.gwwService.SelectedPrimaryNetwork.name:configuration.projectName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"NetworkCode",{get:function(){return this.gwwService.SelectedPrimaryNetwork?this.gwwService.SelectedPrimaryNetwork.code:void 0},enumerable:!0,configurable:!0}),t.prototype.checkAboutModal=function(){null==this.readCookie("GWWhideAbout")&&this.openAboutModal()},t.prototype.openAboutModal=function(t){return t?void this.modalService.openModal(e.Services.ModalType.e_about,{tabName:t}):void this.modalService.openModal(e.Services.ModalType.e_about)},t.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var n=r[o];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},t.$inject=["$scope","$stateParams","GroundWaterWatch.Services.ModalService","GroundWaterWatch.Services.GroundWaterWatchService"],t}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.NavbarController",r)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(t){"use string";var r=function(){function t(e,t,r){var o=this;e.vm=this,this.modalInstance=t,this.GWWService=r,this.init(),e.$watchCollection(function(){return o.SelectedState},function(e,t){e!=t&&(e[0].hasOwnProperty("Counties")&&null!=e[0].Counties||o.GWWService.loadCounties(e[0]),o.SelectedCounties.length=0)})}return Object.defineProperty(t.prototype,"States",{get:function(){return this.GWWService.StateList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SelectedState",{get:function(){return this._selectedState},set:function(e){e!=this._selectedState&&(this._selectedState=e),this._selectedState.length<1||(e[0].hasOwnProperty("Counties")&&null!=e[0].Counties||this.GWWService.loadCounties(e[0]),this.SelectedCounties.length=0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Aquifers",{get:function(){return this.GWWService.AquiferList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Networks",{get:function(){return this.GWWService.NetworkList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Counties",{get:function(){return this.SelectedState.length<1||this.SelectedState[0].Counties.length<0?void 0:this.SelectedState[0].Counties},enumerable:!0,configurable:!0}),t.prototype.Apply=function(){this.SelectedState.length>0&&this.SelectedCounties.length<1&&this.GWWService.AddFilterTypes([new e.Models.GroundWaterFilterSite(this.SelectedState[0],e.Models.FilterType.STATE)]),this.SelectedCounties.length>0&&this.GWWService.AddFilterTypes(this.SelectedCounties.map(function(t){return new e.Models.GroundWaterFilterSite(t,e.Models.FilterType.COUNTY)})),this.modalInstance.dismiss("cancel")},t.prototype.Close=function(){this.modalInstance.dismiss("cancel")},t.prototype.Reset=function(){this.SelectedState=[],this.SelectedCounties=[],this.SelectedAquifers=[],this.SelectedNetworks=[]},t.prototype.init=function(){this.selectedProcedure=1,this.SelectedCounties=[],this.SelectedState=[]},t.$inject=["$scope","$modalInstance","GroundWaterWatch.Services.GroundWaterWatchService"],t}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.FilterModalController",r)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){"use string";var t=function(){function e(e,t,r,o,n){var i=this;e.vm=this,this.sce=t,this.modalInstance=r,this.modalService=n,this.gwwService=o,this.selectedAboutTabName=n.modalOptions.tabName,this.showModal=!0,this.init(),e.$watch(function(){return i.modalService.modalOptions.tabName},function(e,t){return i.selectAboutTab(e)})}return e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.Dismiss=function(){this.showModal?this.eraseCookie("GWWhideAbout"):this.createCookie("GWWhideAbout",!0,30)},e.prototype.selectAboutTab=function(e){this.selectedAboutTabName!=e&&(this.selectedAboutTabName=e)},e.prototype.init=function(){null!=this.readCookie("GWWhideAbout")&&(this.showModal=!this.showModal)},e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},e.prototype.createCookie=function(e,t,r){if(r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3);var n="; expires="+o.toUTCString()}else var n="";document.cookie=e+"="+t+n+"; path=/"},e.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var n=r[o];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},e.prototype.eraseCookie=function(e){this.createCookie(e,"",-1)},e.$inject=["$scope","$sce","$modalInstance","GroundWaterWatch.Services.GroundWaterWatchService","GroundWaterWatch.Services.ModalService"],e}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.AboutModalController",t)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(t){"use string";var r=function(t){function r(r,o,n,i,a,s){var l=this;t.call(this,o,configuration.baseurls.GroundWaterWatch),r.vm=this,this.sce=n,this.modalInstance=i,this.gwwServices=a,this.eventManager=s,this.siteLoaded=!1,this.init(),this.eventManager.SubscribeToEvent(e.Services.onSelectedGWSiteChanged,new WiM.Event.EventHandler(function(){console.log("detected a mouse click/gww site query",l.gwwServices.SelectedGWSite),l.gwwServices.SelectedGWSite&&l.getOldGWWpage()}))}return __extends(r,t),r.prototype.Close=function(){this.modalInstance.dismiss("cancel")},r.prototype.convertUnsafe=function(e){return console.log("converting..."),this.sce.trustAsHtml(e)},r.prototype.replaceAll=function(e,t,r){return e.replace(new RegExp(t,"g"),r)},r.prototype.getOldGWWpage=function(){var e=this;this.pagecontent="";var t="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D'http%3A%2F%2Fgroundwaterwatch.usgs.gov%2FAWLSites.asp%3Fmt%3Dg%26S%3D"+this.gwwServices.SelectedGWSite.properties.SITE_NO+"%26ncd%3Dawl'&format=xml&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){if(e.siteLoaded=!0,t.data.indexOf("dws_maps")>0){var r=t.data.replace('<table border="0" cellpadding="3" cellspacing="0" width="950px">','<table border="0" cellpadding="3" cellspacing="0" width="950px" style="display:none;">');r=r.replace('<div id="usgsfooter">','<div id="usgsfooter" style="display:none;">'),r=e.replaceAll(r,"iframe","div"),r=e.replaceAll(r,'<td valign="top" width="550">','<td valign="top" width="550" style="display:none;">'),r=e.replaceAll(r,'src="../','src="http://groundwaterwatch.usgs.gov/'),r=e.replaceAll(r,'src="images/','src="http://groundwaterwatch.usgs.gov/images/'),r=e.replaceAll(r,'src="../images/','src="http://groundwaterwatch.usgs.gov/images/'),r=e.replaceAll(r,'src="BandPlots-small/','src="http://groundwaterwatch.usgs.gov/BandPlots-small/'),r=e.replaceAll(r,'src="DVPlotsSmall/','src="http://groundwaterwatch.usgs.gov/DVPlotsSmall/'),r=e.replaceAll(r,'src="wlplotssmall/','src="http://groundwaterwatch.usgs.gov/wlplotssmall/'),r=e.replaceAll(r,'src="plots-prsmall/','src="http://groundwaterwatch.usgs.gov/plots-prsmall/'),r=e.replaceAll(r,'color="red"','color="black"'),e.pagecontent=r}else console.log("No page found for this site"),e.pagecontent='<div class="alert alert-warning" role="alert">No page found for this site: '+e.gwwServices.SelectedGWSite.properties.SITE_NO+'<a href = "http://groundwaterwatch.usgs.gov/AWLSites.asp?mt=g&S='+e.gwwServices.SelectedGWSite.properties.SITE_NO+'&ncd=awl" target="_blank"> GWW Page link </a></div>'},function(e){console.log("No gww sites found")})["finally"](function(){})},r.prototype.init=function(){this.pagecontent=""},r.$inject=["$scope","$http","$sce","$modalInstance","GroundWaterWatch.Services.GroundWaterWatchService","WiM.Event.EventManager"],r}(WiM.Services.HTTPServiceBase);angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.SiteInfoModalController",r)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));