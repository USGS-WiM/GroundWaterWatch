var GroundWaterWatch;!function(e){var t=function(){function e(e,t,r,o){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$logProvider=o,this.$stateProvider.state("main",{url:"/?ncd&sc&cc&S",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"GroundWaterWatch.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"GroundWaterWatch.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"GroundWaterWatch.Controllers.NavbarController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider"],e}();angular.module("GroundWaterWatch",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","angulartics","angulartics.google.analytics","toaster","ngAnimate","ngFileUpload","leaflet-directive","GroundWaterWatch.Services","GroundWaterWatch.Controllers","WiM.Services","WiM.Event","wim_angular","angularResizable"]).config(t)}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){var t=function(){function e(){}return e.FromJson=function(t){if(!t)return null;var r=t.hasOwnProperty("properties")?t.properties:null,o=new e;return o.siteNO=r.hasOwnProperty("SITE_NO")?r.SITE_NO:"---",o.siteName=r.hasOwnProperty("SITE_NAME")?r.SITE_NAME:"---",o.measurement=r.hasOwnProperty("LATEST_VALUE")?r.LATEST_VALUE:Number.NaN,o.measurementDate=r.hasOwnProperty("LATEST_DATE")?r.LATEST_DATE:null,o.wellDepth=r.hasOwnProperty("WELL_DEPTH")?r.WELL_DEPTH:Number.NaN,o.localAquiferName=r.hasOwnProperty("LOCAL_AQUIFER_NAME")?r.LOCAL_AQUIFER_NAME:"---",o.stateName=r.hasOwnProperty("STATE_NM")?r.STATE_NM:"---",o.countyName=r.hasOwnProperty("COUNTY_NM")?r.COUNTY_NM:"---",o.geometry=t.hasOwnProperty("geometry")?r.geometry:null,o},e}();e.GroundWaterSite=t}(t=e.Models||(e.Models={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){var t=function(){function e(e,t){this.Name=e,this.Type=t}return e}();e.GroundWaterFilterSite=t,function(e){e[e.STATE=1]="STATE",e[e.COUNTY=2]="COUNTY",e[e.NETWORK=3]="NETWORK",e[e.AQUIFER=4]="AQUIFER",e[e.SITE=5]="SITE"}(e.FilterType||(e.FilterType={}));e.FilterType}(t=e.Models||(e.Models={}))}(GroundWaterWatch||(GroundWaterWatch={})),function(){"use strict";angular.module("GroundWaterWatch.Services",[])}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(e){"use strict";function t(e,t,o){return new r(e,t,o)}var r=function(e){function t(t,r,o){e.call(this,t,configuration.baseurls.GroundWaterWatch),this.$q=r,this.toaster=o,this.drawElevationProfile=!1,this.drawMeasurement=!1,this.showElevationChart=!1,this.allowStreamgageQuery=!1,this.measurementData=""}return __extends(t,e),t.prototype.elevationProfile=function(e){var t=this,r="http://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",o=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:e,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(o).then(function(e){var r=e.data.results[0].value.features[0].geometry.paths[0];r.length>0&&(t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:r},properties:""}]})},function(e){})["finally"](function(){})},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("GroundWaterWatch.Services").factory("GroundWaterWatch.Services.ExplorationService",t)}(t=e.Services||(e.Services={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){"use strict";function t(e){return new r(e)}var r=function(){function e(e){this.modal=e}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),t&&(this.modalOptions=t),this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case o.e_filter:return{templateUrl:"Views/filtermodal.html",controller:"GroundWaterWatch.Controllers.FilterModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case o.e_about:return{templateUrl:"Views/aboutmodal.html",controller:"GroundWaterWatch.Controllers.AboutModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case o.e_siteinfo:return{templateUrl:"Views/siteinfomodal.html",controller:"GroundWaterWatch.Controllers.SiteInfoModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};default:return{templateUrl:"Views/aboutmodal.html",controller:"GroundWaterWatch.Controllers.AboutModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"}}}catch(t){return!1}},e}();!function(e){e[e.e_filter=1]="e_filter",e[e.e_about=2]="e_about",e[e.e_siteinfo=3]="e_siteinfo"}(e.ModalType||(e.ModalType={}));var o=e.ModalType;t.$inject=["$modal"],angular.module("GroundWaterWatch.Services").factory("GroundWaterWatch.Services.ModalService",t)}(t=e.Services||(e.Services={}))}(GroundWaterWatch||(GroundWaterWatch={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(t){"use strict";function r(e,t){return new o(e,t)}t.onSelectedGWSiteChanged="onSelectedGWSiteChanged";var o=function(r){function o(e,t){r.call(this,e,configuration.baseurls.GroundWaterWatch),this.SelectedGWFilters=[],this._eventManager=t,this.queriedGWsite=!1,this.init()}return __extends(o,r),Object.defineProperty(o.prototype,"GWSiteList",{get:function(){return this._GWSiteList},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"SelectedGWSite",{get:function(){return this._selectedGWSite},set:function(e){e!=this._selectedGWSite&&(this._selectedGWSite=e,this._eventManager.RaiseEvent(t.onSelectedGWSiteChanged,this,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),o.prototype.AddFilterTypes=function(e){var t=this;e.forEach(function(e){return t.SelectedGWFilters.push(e)}),this.updateGWWSiteList()},o.prototype.getFilterRequest=function(){if(this.SelectedGWFilters.length<1)return"";var t=[],r=this.SelectedGWFilters.group("Type"),o=r.hasOwnProperty(e.Models.FilterType.STATE.toString())?r[e.Models.FilterType.STATE.toString()].map(function(e){return e.Name}):null;null!==o&&t.push("STATE_CD in ('"+o.join("','")+"')");var n=r.hasOwnProperty(e.Models.FilterType.NETWORK.toString())?r[e.Models.FilterType.NETWORK.toString()].map(function(e){return e.Name}):null;null!==n&&t.push("NETWORK_CD in ('"+n.join("','")+"')");var a=r.hasOwnProperty(e.Models.FilterType.COUNTY.toString())?r[e.Models.FilterType.COUNTY.toString()].map(function(e){return e.Name}):null;null!==a&&t.push("COUNTY_CD in ('"+a.join("','")+"')");var i=r.hasOwnProperty(e.Models.FilterType.SITE.toString())?r[e.Models.FilterType.SITE.toString()].map(function(e){return e.Name}):null;return null!==i&&t.push("SITE_NO in ('"+i.join("','")+"')"),t.join(" AND ")},o.prototype.queryGWsite=function(e,t,r,o,n,a){var i=this;this.queriedGWsite=!1;var s=configuration.baseurls.GroundWaterWatch+"/groundwaterwatch/wms?";s+="&INFO_FORMAT=application/json",s+="&EXCEPTIONS=application/json",s+="&REQUEST=GetFeatureInfo",s+="&SERVICE=wms&VERSION=1.1.1&WIDTH="+n+"&HEIGHT="+a+"&X="+r+"&Y="+o+"&BBOX="+t,s+="&LAYERS=groundwaterwatch:Latest_WL_Percentile&QUERY_LAYERS=groundwaterwatch:Latest_WL_Percentile&buffer=10";var l=new WiM.Services.Helpers.RequestInfo(s,!0);this.Execute(l).then(function(e){i.queriedGWsite=!0,e.data.features&&e.data.features.length>0?e.data.features.forEach(function(e){console.log(e),i.SelectedGWSite=e}):(console.log("No gww sites found"),i.SelectedGWSite=null)},function(e){console.log("No gww sites found")})["finally"](function(){})},o.prototype.init=function(){this._GWSiteList=[],this._eventManager.AddEvent(t.onSelectedGWSiteChanged)},o.prototype.updateGWWSiteList=function(){var e=this,t=this.getFilterRequest(),r=configuration.baseurls.GroundWaterWatch+"/groundwaterwatch/wfs?";r+="&SERVICE=wfs&VERSION=1.1.1",r+="&outputFormat=application/json",r+="&REQUEST=getfeature",r+="&typename=groundwaterwatch:Latest_WL_Percentile",""!=t&&(r+="&CQL_FILTER="+t);var o=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(o).then(function(t){e.queriedGWsite=!0,t.data.features&&t.data.features.length>0?t.data.features.forEach(function(e){console.log(e)}):(console.log("No gww sites found"),e.SelectedGWSite=null)},function(e){console.log("No gww sites found")})["finally"](function(){})},o}(WiM.Services.HTTPServiceBase);r.$inject=["$http","WiM.Event.EventManager"],angular.module("GroundWaterWatch.Services").factory("GroundWaterWatch.Services.GroundWaterWatchService",r)}(t=e.Services||(e.Services={}))}(GroundWaterWatch||(GroundWaterWatch={})),function(){"use strict";angular.module("GroundWaterWatch.Controllers",[])}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(t){"use strict";var r=function(){function e(){this.lat=0,this.lng=0}return e}(),o=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),n=(function(){function e(e,t,r,o,n){void 0===n&&(n=void 0),this.name=e,this.url=t,this.type=r,this.visible=o,this.layerOptions=n}return e}(),function(){function e(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}return e}());t.onBoundingBoxChanged="onBoundingBoxChanged";var a=function(e){function t(t,r){e.call(this),this.zoomlevel=r,this.northern=t.northEast.lng,this.southern=t.southWest.lng,this.eastern=t.northEast.lat,this.western=t.southWest.lat}return __extends(t,e),t}(WiM.Event.EventArgs);t.BoundingBoxChangedEventArgs=a;var i=function(){function i(r,o,n,a,i,s,l,c,u,d,h,p,f,v){var g=this;if(this.$scope=r,this.initialized=!1,this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,r.vm=this,o.isShown=!0,this.init(),this.toaster=n,this.angulartics=a,this.searchService=u,this.$locationService=i,this.leafletBoundsHelperService=l,this.leafletData=c,this.explorationService=d,this.eventManager=h,this.gwwServices=p,this.SiteList=p.GWSiteList,this.modalService=f,this.SiteListEnabled=!1,this.eventManager.AddEvent(t.onBoundingBoxChanged),this.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){g.onLayerChanged(e,t)})),this.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){g.onSelectedAreaOfInterestChanged(e,t)})),r.$on("leafletDirectiveMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;g.mapPoint.lat=r.lat,g.mapPoint.lng=r.lng}),r.$on("leafletDirectiveMap.drag",function(e,t){g.cursorStyle="grabbing"}),r.$on("leafletDirectiveMap.dragend",function(e,t){g.cursorStyle="pointer"}),r.$watch(function(){return g.bounds},function(e,t){return g.mapBoundsChange(t,e)}),r.$on("leafletDirectiveMap.click",function(t,r){g.gwwServices.SelectedGWSite=null,g.modalService.openModal(e.Services.ModalType.e_siteinfo),g.leafletData.getMap().then(function(e){var t=e.getBounds().toBBoxString(),o=Math.round(e.layerPointToContainerPoint(r.leafletEvent.layerPoint).x),n=Math.round(e.layerPointToContainerPoint(r.leafletEvent.layerPoint).y),a=e.getSize().x,i=e.getSize().y;g.gwwServices.queryGWsite(r.leafletEvent.latlng,t,o,n,a,i)})}),r.$watch(function(){return g.bounds},function(e,t){return g.mapBoundsChange(t,e)}),r.$watch(function(){return g.explorationService.elevationProfileGeoJSON},function(e,t){e&&g.displayElevationProfile()}),r.$watch(function(){return g.explorationService.drawElevationProfile},function(e,t){e&&g.elevationProfile()}),r.$watch(function(){return g.explorationService.drawMeasurement},function(e,t){e&&g.measurement()}),r.$watch(function(){return g.SiteList},function(e,t){e.length>0?g.SiteListEnabled=!0:g.SiteListEnabled=!1}),r.$watchCollection(function(){return g.gwwServices.SelectedGWFilters},function(e,t){e&&g.updateMapFilters()}),v(function(){g.leafletData.getMap().then(function(e){e.invalidateSize()})}),s.ncd||s.sc||s.cc||s.S){var S=[];s.ncd&&s.ncd.split(",").forEach(function(t){S.push(new e.Models.GroundWaterFilterSite(t,e.Models.FilterType.NETWORK))}),s.sc&&s.sc.split(",").forEach(function(t){S.push(new e.Models.GroundWaterFilterSite(String(t),e.Models.FilterType.STATE))}),s.cc&&s.cc.split(",").forEach(function(t){S.push(new e.Models.GroundWaterFilterSite(t,e.Models.FilterType.COUNTY))}),s.S&&s.S.split(",").forEach(function(t){S.push(new e.Models.GroundWaterFilterSite(t,e.Models.FilterType.SITE))}),this.gwwServices.AddFilterTypes(S),o.isShown=!1}this.initialized=!0}return i.prototype.init=function(){this.cursorStyle="pointer",this.center=new o(39,-100,3),this.nominalZoomLevel=this.scaleLookup(this.center.zoom),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new n(null,3,!0),this.markers={},this.geojson={},this.regionLayer={},this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images"},i.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},i.prototype.elevationProfile=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0;var t;this.controls.custom.forEach(function(e){e._container.className.indexOf("elevation")>-1&&(t=e)}),this.angulartics.eventTrack("explorationTools",{category:"Map",label:"elevationProfile"}),this.leafletData.getMap().then(function(r){e.leafletData.getLayers().then(function(o){var n=o.overlays.draw;n.clearLayers(),e.drawController({metric:!1},!0),delete e.geojson.elevationProfileLine3D,r.on("draw:drawstart",function(e){t.clear()}),r.on("draw:created",function(t){r.removeEventListener("draw:created");var o=t.layer.toGeoJSON(),n='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(o.geometry.coordinates)+"]}}]}";e.cursorStyle="wait",e.toaster.pop("info","Information","Querying the elevation service...",0),e.explorationService.elevationProfile(n),e.explorationService.drawElevationProfile=!1,r.panBy([0,1])})})})},i.prototype.drawController=function(e,t){var r=this;return t?void this.leafletData.getMap().then(function(t){r.drawControl=new L.Draw.Polyline(t,e),r.drawControl.enable()}):(this.drawControl.disable(),void(this.drawControl=void 0))},i.prototype.displayElevationProfile=function(){var e;this.controls.custom.forEach(function(t){t._container&&t._container.className.indexOf("elevation")>-1&&(e=t)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:e.addData.bind(e)},this.leafletData.getMap().then(function(t){var r=e.onAdd(t);document.getElementById("elevation-div").innerHTML="",document.getElementById("elevation-div").appendChild(r)}),this.toaster.clear(),this.cursorStyle="pointer"},i.prototype.showLocation=function(){var e;this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start()},i.prototype.resetMap=function(){this.removeOverlayLayers("_region",!0),this.center=new o(39,-100,3)},i.prototype.resetExplorationTools=function(){document.getElementById("elevation-div").innerHTML="",document.getElementById("measurement-div").innerHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.allowStreamgageQuery=!1,this.explorationService.drawMeasurement=!1,this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.showElevationChart=!1},i.prototype.measurement=function(){var e=this;document.getElementById("elevation-div").innerHTML="",this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"measurement"}),this.leafletData.getMap().then(function(t){e.leafletData.getLayers().then(function(r){var o=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var n=r.overlays.draw;n.clearLayers();var a=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},i=function(){0==o&&(o=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",a))},s=function(r){var o=r.layer;n.addLayer(o),n.addTo(t),e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString(),t.off("click",i),t.off("mousemove",a),t.off("draw:created",s),e.drawControl.disable(),e.explorationService.drawMeasurement=!1};t.on("click",i),t.on("draw:created",s)})})},i.prototype.onSelectedGWSiteChanged=function(){this.modalService.openModal(e.Services.ModalType.e_siteinfo)},i.prototype.onSelectedAreaOfInterestChanged=function(e,t){this.angulartics.eventTrack("Search",{category:"Sidebar"}),this.markers={};var r=t.selectedAreaOfInterest;if("U.S. State or Territory"==r.Category)var o=9;else var o=14;this.markers.AOI={lat:r.Latitude,lng:r.Longitude,message:r.Name,focus:!0,draggable:!1},this.leafletData.getMap().then(function(e){e.setView([r.Latitude,r.Longitude],o)})},i.prototype.removeGeoJson=function(e){void 0===e&&(e="");for(var t in this.geojson)"function"!=typeof this.geojson[t]&&(delete this.geojson[t],this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs(t,"geojson")))},i.prototype.addGeoJSON=function(e,t){this.geojson[e]={data:t,style:{fillOpacity:0}}},i.prototype.onLayerChanged=function(e,t){if("visible"===t.PropertyName)if(t.Value);else delete this.geojson[t.LayerName]},i.prototype.mapBoundsChange=function(e,r){e!==r&&(this.nominalZoomLevel=this.scaleLookup(this.center.zoom),this.eventManager.RaiseEvent(t.onBoundingBoxChanged,this,new a(this.bounds,this.center.zoom)))},i.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var o;o=this.getLayerIdsByID(e,this.layers.overlays,t),o.forEach(function(e){delete r.layers.overlays[e]})},i.prototype.getLayerIdsByName=function(e,t,r){var o=[];for(var n in t)t[n].hasOwnProperty("name")&&(r?t[n].name.indexOf(e)>-1:t[n].name===e)&&o.push(n);return o},i.prototype.getLayerIdsByID=function(e,t,r){var o=[];for(var n in t)(r?n.indexOf(e)>-1:n===e)&&o.push(n);return o},i.prototype.updateMapFilters=function(){var t=this;this.initialized&&this.leafletData.getLayers().then(function(r){var o=t.gwwServices.getFilterRequest();""!=o?r.overlays.gww.wmsParams.CQL_FILTER=o:delete r.overlays.gww.wmsParams.CQL_FILTER,r.overlays.gww.redraw();var n=t.gwwServices.SelectedGWFilters.group("Type");n.hasOwnProperty(e.Models.FilterType.STATE.toString())&&r.overlays.states.query().layer(7).where(n[e.Models.FilterType.STATE.toString()].map(function(e){return"STATE = '"+e.Name+"'"}).join(" OR ")).returnGeometry(!0).fields("STATE,ABBREV,NAME").run(function(e,r){r.features&&0!=r.features.length&&r.features.forEach(function(e){"Polygon"===e.geometry.type&&t.addGeoJSON("STATE"+e.properties.STATE,e.geometry)})}),n.hasOwnProperty(e.Models.FilterType.COUNTY.toString())&&r.overlays.counties.query().layer(15).where(n[e.Models.FilterType.COUNTY.toString()].map(function(e){return"COUNTY = '"+e.Name+"' AND STATE = '08'"}).join(" OR ")).returnGeometry(!0).fields("COUNTY,STATE,NAME").run(function(e,r){r.features&&0!=r.features.length&&r.features.forEach(function(e){"Polygon"===e.geometry.type&&t.addGeoJSON("COUNTY"+e.properties.COUNTY,e.geometry)})})})},i.$inject=["$scope","$rootScope","toaster","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","GroundWaterWatch.Services.ExplorationService","WiM.Event.EventManager","GroundWaterWatch.Services.GroundWaterWatchService","GroundWaterWatch.Services.ModalService","$timeout"],i}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.MapController",i)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(t){"use strinct";var r,o=function(){function t(e,t,r,o,n,a,i){e.vm=this,this.toaster=t,this.angulartics=r,this.searchService=n,this.groundwaterwatchService=i,this.modalService=a,this.init()}return t.prototype.getLocations=function(e){return this.searchService.getLocations(e)},t.prototype.setProcedureType=function(e){this.selectedProcedure!=e&&this.canUpdateProcedure(e)&&(this.selectedProcedure=e)},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.zoomRegion=function(e){angular.fromJson(e)},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#sapi-searchTextBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.removeFilter=function(e){var t=this.SelectedFilters.indexOf(e);this.SelectedFilters.splice(t)},t.prototype.ClearFilters=function(){this.SelectedFilters.splice(0,this.SelectedFilters.length)},t.prototype.AddFilter=function(){this.modalService.openModal(e.Services.ModalType.e_filter)},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.init=function(){this.SelectedFilters=this.groundwaterwatchService.SelectedGWFilters,this.sideBarCollapsed=!1,this.selectedProcedure=r.Search},t.prototype.canUpdateProcedure=function(e){try{switch(e){case r.Search:return!0;case r.NetworkType:return!0;case r.Filter:return!0;default:return!1}}catch(t){return!1}},t.prototype.sm=function(e){try{}catch(t){}},t.$inject=["$scope","toaster","$stateParams","$analytics","WiM.Services.SearchAPIService","GroundWaterWatch.Services.ModalService","GroundWaterWatch.Services.GroundWaterWatchService"],t}();!function(e){e[e.Search=1]="Search",e[e.NetworkType=2]="NetworkType",e[e.Filter=3]="Filter"}(r||(r={})),angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.SidebarController",o)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(t){"use strict";var r=function(){function t(e,t,r){e.vm=this,this.modalService=r}return Object.defineProperty(t.prototype,"ProjectName",{get:function(){return configuration.projectName},enumerable:!0,configurable:!0}),t.prototype.openAboutModal=function(){this.modalService.openModal(e.Services.ModalType.e_about)},t.$inject=["$scope","$stateParams","GroundWaterWatch.Services.ModalService"],t}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.NavbarController",r)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(t){"use string";var r=function(){function t(e,t,r){e.vm=this,this.modalInstance=t,this.GWWService=r,this.init()}return t.prototype.Close=function(){this.SelectedStates.length>0&&this.GWWService.AddFilterTypes(this.SelectedStates),this.SelectedCounties.length>0&&this.GWWService.AddFilterTypes(this.SelectedCounties),this.SelectedAquifers.length>0&&this.GWWService.AddFilterTypes(this.SelectedAquifers),this.modalInstance.dismiss("cancel")},t.prototype.AddStateFilter=function(t){this.SelectedStates.push(new e.Models.GroundWaterFilterSite("08",e.Models.FilterType.STATE))},t.prototype.AddCountyFilter=function(t){this.SelectedCounties.push(new e.Models.GroundWaterFilterSite("003",e.Models.FilterType.COUNTY))},t.prototype.AddAquiferFilter=function(t){this.SelectedAquifers.push(new e.Models.GroundWaterFilterSite(t,e.Models.FilterType.AQUIFER))},t.prototype.init=function(){this.SelectedAquifers=[],this.SelectedCounties=[],this.SelectedStates=[]},t.$inject=["$scope","$modalInstance","GroundWaterWatch.Services.GroundWaterWatchService"],t}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.FilterModalController",r)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var GroundWaterWatch;!function(e){var t;!function(e){"use string";var t=function(){function e(e,t){e.vm=this,this.modalInstance=t,this.init()}return e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.init=function(){},e.$inject=["$scope","$modalInstance"],e}();angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.AboutModalController",t)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},GroundWaterWatch;!function(e){var t;!function(t){"use string";var r=function(t){function r(r,o,n,a,i,s){var l=this;t.call(this,o,configuration.baseurls.GroundWaterWatch),r.vm=this,this.sce=n,this.modalInstance=a,this.gwwServices=i,this.eventManager=s,this.siteLoaded=!1,this.init(),this.eventManager.SubscribeToEvent(e.Services.onSelectedGWSiteChanged,new WiM.Event.EventHandler(function(){console.log("detected a mouse click/gww site query",l.gwwServices.SelectedGWSite),l.gwwServices.SelectedGWSite&&l.getOldGWWpage()}))}return __extends(r,t),r.prototype.Close=function(){this.modalInstance.dismiss("cancel")},r.prototype.convertUnsafe=function(e){return console.log("converting..."),this.sce.trustAsHtml(e)},r.prototype.replaceAll=function(e,t,r){return e.replace(new RegExp(t,"g"),r)},r.prototype.getOldGWWpage=function(){var e=this;this.pagecontent="";var t="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D'http%3A%2F%2Fgroundwaterwatch.usgs.gov%2FAWLSites.asp%3Fmt%3Dg%26S%3D"+this.gwwServices.SelectedGWSite.properties.SITE_NO+"%26ncd%3Dawl'&format=xml&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){if(e.siteLoaded=!0,t.data.indexOf("dws_maps")>0){var r=t.data.replace('<table border="0" cellpadding="3" cellspacing="0" width="950px">','<table border="0" cellpadding="3" cellspacing="0" width="950px" style="display:none;">');r=r.replace('<div id="usgsfooter">','<div id="usgsfooter" style="display:none;">'),r=e.replaceAll(r,"iframe","div"),r=e.replaceAll(r,'<td valign="top" width="550">','<td valign="top" width="550" style="display:none;">'),r=e.replaceAll(r,'src="../','src="http://groundwaterwatch.usgs.gov/'),r=e.replaceAll(r,'src="images/','src="http://groundwaterwatch.usgs.gov/images/'),r=e.replaceAll(r,'src="../images/','src="http://groundwaterwatch.usgs.gov/images/'),r=e.replaceAll(r,'src="BandPlots-small/','src="http://groundwaterwatch.usgs.gov/BandPlots-small/'),r=e.replaceAll(r,'src="DVPlotsSmall/','src="http://groundwaterwatch.usgs.gov/DVPlotsSmall/'),r=e.replaceAll(r,'src="wlplotssmall/','src="http://groundwaterwatch.usgs.gov/wlplotssmall/'),r=e.replaceAll(r,'src="plots-prsmall/','src="http://groundwaterwatch.usgs.gov/plots-prsmall/'),r=e.replaceAll(r,'color="red"','color="black"'),e.pagecontent=r}else console.log("No page found for this site"),e.pagecontent='<div class="alert alert-warning" role="alert">No page found for this site: '+e.gwwServices.SelectedGWSite.properties.SITE_NO+'<a href = "http://groundwaterwatch.usgs.gov/AWLSites.asp?mt=g&S='+e.gwwServices.SelectedGWSite.properties.SITE_NO+'&ncd=awl" target="_blank"> GWW Page link </a></div>'},function(e){console.log("No gww sites found")})["finally"](function(){})},r.prototype.init=function(){this.pagecontent=""},r.$inject=["$scope","$http","$sce","$modalInstance","GroundWaterWatch.Services.GroundWaterWatchService","WiM.Event.EventManager"],r}(WiM.Services.HTTPServiceBase);angular.module("GroundWaterWatch.Controllers").controller("GroundWaterWatch.Controllers.SiteInfoModalController",r)}(t=e.Controllers||(e.Controllers={}))}(GroundWaterWatch||(GroundWaterWatch={}));